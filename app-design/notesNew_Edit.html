<html></html>
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Plus+Jakarta+Sans:wght@400;500;700;800" />
    <title>New/Edit Note</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="app.js"></script>
  </head>
  <body>
    <div class="relative flex min-h-screen flex-col bg-[#faf9fb] justify-between overflow-x-hidden">
      <header class="flex items-center justify-between px-4 py-3 bg-[#faf9fb] border-b border-[#ded3e4]">
        <h1 class="text-lg font-bold text-[#161019]">Ammu's Diary</h1>
        <button id="menu-btn" class="p-2 rounded-full hover:bg-[#efe9f1] focus:outline-none">
          <span class="sr-only">Open settings</span>
          <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></svg>
        </button>
      </header>
      <div>
        <div class="flex items-center bg-[#faf9fb] p-4 pb-2 justify-between">
          <div class="text-[#161019] flex size-12 shrink-0 items-center" id="back-btn" style="cursor:pointer;">
            <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
              <path d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"></path>
            </svg>
          </div>
          <h2 class="text-[#161019] text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12" id="form-title">New Note</h2>
        </div>
        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
          <label class="flex flex-col min-w-40 flex-1">
            <input id="note-title" placeholder="Title" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#161019] focus:outline-0 focus:ring-0 border-none bg-[#efe9f1] focus:border-none h-14 placeholder:text-[#7c588d] p-4 text-base font-normal leading-normal" />
          </label>
        </div>
        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
          <label class="flex flex-col min-w-40 flex-1">
            <textarea id="note-content" placeholder="Write your note here..." class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#161019] focus:outline-0 focus:ring-0 border-none bg-[#efe9f1] focus:border-none min-h-36 placeholder:text-[#7c588d] p-4 text-base font-normal leading-normal"></textarea>
          </label>
        </div>
        <h3 class="text-[#161019] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4">Mood</h3>
        <div class="flex flex-wrap gap-3 p-4">
          <label class="text-sm font-medium leading-normal flex items-center justify-center rounded-xl border border-[#ded3e4] px-4 h-11 text-[#161019] has-[:checked]:border-[3px] has-[:checked]:px-3.5 has-[:checked]:border-[#be7edc] relative cursor-pointer">
            Happy
            <input type="radio" class="invisible absolute" name="note-mood" value="Happy" data-emoji="😃" />
          </label>
          <label class="text-sm font-medium leading-normal flex items-center justify-center rounded-xl border border-[#ded3e4] px-4 h-11 text-[#161019] has-[:checked]:border-[3px] has-[:checked]:px-3.5 has-[:checked]:border-[#be7edc] relative cursor-pointer">
            Neutral
            <input type="radio" class="invisible absolute" name="note-mood" value="Neutral" data-emoji="😐" />
          </label>
          <label class="text-sm font-medium leading-normal flex items-center justify-center rounded-xl border border-[#ded3e4] px-4 h-11 text-[#161019] has-[:checked]:border-[3px] has-[:checked]:px-3.5 has-[:checked]:border-[#be7edc] relative cursor-pointer">
            Sad
            <input type="radio" class="invisible absolute" name="note-mood" value="Sad" data-emoji="😢" />
          </label>
          <label class="text-sm font-medium leading-normal flex items-center justify-center rounded-xl border border-[#ded3e4] px-4 h-11 text-[#161019] has-[:checked]:border-[3px] has-[:checked]:px-3.5 has-[:checked]:border-[#be7edc] relative cursor-pointer">
            Angry
            <input type="radio" class="invisible absolute" name="note-mood" value="Angry" data-emoji="😡" />
          </label>
        </div>
        <div class="flex gap-4 px-4 py-4">
          <button id="save-btn" class="flex-1 bg-[#be7edc] text-white rounded-xl py-3 font-bold">Save Note</button>
          <button id="cancel-btn" class="flex-1 bg-[#efe9f1] text-[#161019] rounded-xl py-3 font-bold">Cancel</button>
        </div>
      </div>
    </div>
    <script>
      window.AmmuDiary.applyAllSettings();
      function getNoteId() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
      }
      function getFormData() {
        return {
          title: document.getElementById('note-title').value,
          content: document.getElementById('note-content').value,
          mood: document.querySelector('input[name="note-mood"]:checked')?.value || '',
          moodEmoji: document.querySelector('input[name="note-mood"]:checked')?.dataset.emoji || '',
          date: new Date().toLocaleString()
        };
      }
      function setFormData(note) {
        document.getElementById('note-title').value = note.title || '';
        document.getElementById('note-content').value = note.content || '';
        if (note.mood) {
          let moodRadio = document.querySelector(`input[name="note-mood"][value="${note.mood}"]`);
          if (moodRadio) moodRadio.checked = true;
        }
      }
      document.addEventListener('DOMContentLoaded', function() {
        // Back button
        document.getElementById('back-btn').onclick = function() {
          window.location = 'notes.html';
        };
        // Menu button
        document.getElementById('menu-btn').onclick = function() {
          window.location = 'settings.html';
        };
        // Cancel button
        document.getElementById('cancel-btn').onclick = function() {
          window.location = 'notes.html';
        };
        // Edit mode
        const id = getNoteId();
        if (id) {
          const note = window.AmmuDiary.getNotes().find(n => n.id === id);
          if (note) {
            setFormData(note);
            document.getElementById('form-title').innerText = 'Edit Note';
            document.getElementById('save-btn').innerText = 'Update Note';
          }
        }
        // Save
        document.getElementById('save-btn').onclick = function() {
          const data = getFormData();
          if (!data.title && !data.content) {
            alert('Please enter a title or content.');
            return;
          }
          if (id) {
            window.AmmuDiary.updateNote(id, data);
          } else {
            window.AmmuDiary.addNote({ ...data, id: window.AmmuDiary.uuidv4() });
          }
          window.location = 'notes.html';
        };
      });
    </script>
  </body>
</html>
